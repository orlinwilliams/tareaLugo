///-----------------------------------------------USUARIOS
var usuarios = [
    {
        nombre:"Pedro",
        apellido:"Martinez",
        ordenes:[
            {
                nombreProducto:"Producto 1",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad:2,
                precio:49.99
            },
            {
                nombreProducto:"Producto 2",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad:2,
                precio:49.99
            }
        ]
    },
    {
        nombre:"Juan",
        apellido:"Perez",
        ordenes:[
            {
                nombreProducto:"Producto 3",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad:2,
                precio:49.99
            },
            {
                nombreProducto:"",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad:2,
                precio:49.99
            }
        ]
    },
    {
        nombre:"Maria",
        apellido:"Rodriguez",
        ordenes:[
            {
                nombreProducto:"Producto 4",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad:2,
                precio:49.99
            },
            {
                nombreProducto:"Producto 1",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad:2,
                precio:49.99
            }
        ]
    }
];


///-----------------------------------------------CATEGORIAS
var categorias = [
    {
        nombreCategoria:"Farmacias",
        descripcion:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color:"#FADB54",
        icono:"fas fa-pills",
        empresas:[
            {
                nombreEmpresa: "Empresa 1",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria:"Restaurantes",
        descripcion:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color:"#F9B1F9",
        icono:"fas fa-utensils",
        empresas:[
            {
                nombreEmpresa: "Empresa 1",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria:"Salud",
        descripcion:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color:"#D98F6D",
        icono:"fas fa-heartbeat",
        empresas:[
            {
                nombreEmpresa: "Empresa 1",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria:"Café",
        descripcion:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color:"#9482C4",
        icono:"fas fa-coffee",
        empresas:[
            {
                nombreEmpresa: "Empresa 1",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria:"Bebidas",
        descripcion:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color:"#F3AC85",
        icono:"fas fa-glass-whiskey",
        empresas:[
            {
                nombreEmpresa: "Empresa 1",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen:"img/banner.jpg",
                productos:[
                    {
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    }
];

console.log ('Usuarios', usuarios);
console.log ('Categorias', categorias);

const localStorage = window.localStorage

//verifica si hay datos
const storageEmpty = () => {
    let user = localStorage.getItem('usuarios');
    let cate = localStorage.getItem('categorias');
    if(user == null && cate == null ){
        return 1
    }
    else{
        
        return 0
    } 
}

//inserta la data nueva o ya existente
const insertData = () => {

    if(storageEmpty() == 1 ){
        localStorage.setItem('usuarios',JSON.stringify(usuarios))
        localStorage.setItem('categorias',JSON.stringify(categorias))
    }
   else{
       //carga la informacion de localstore 
        usuarios = JSON.parse(localStorage.getItem('usuarios'));
        categorias = JSON.parse(localStorage.getItem('categorias'));
   } 
}
insertData();

// muestra las categorias y el select
const setHome = () => {
    let usuarios = JSON.parse(localStorage.getItem('usuarios'));
    let categorias = JSON.parse(localStorage.getItem('categorias'));
    let contenedorC = document.getElementById('contenedorCategorias');
    let contenedorU = document.getElementById('contenedorUsuarios'); 
    
    contenedorU.innerHTML = '';
    contenedorC.innerHTML = '';
    categorias.forEach(element => {

        contenedorC.innerHTML += `<div class="col-4 col-md-2 col-lg-2 caja" onclick="verEmpresas('${element.nombreCategoria}')" style="background-color:${element.color}" >
                                    <div class="row caja-icono">
                                        <div class="col-lg-4">
                                            <i class="${element.icono}"></i>          
                                        </div>
                                    </div>
                                    <div class="row caja-texto">
                                        <div class="col">
                                            <span class="text-white"><strong>${element.nombreCategoria}</strong></span><br>
                                            <span class="text-white">${element.empresas.length} comercios</span>
                                        </div>
                                    </div>
                                </div>`

    });
    
    let nombreUsuarioPedido = document.getElementById('nombrePedido');
    let misOrdenes = document.getElementById('misPedidos');
    misOrdenes.innerHTML = ''
    usuarios.forEach((element, index) => {
        contenedorU.innerHTML += `<option value="${index}">${element.nombre+' '+element.apellido}</option>`
        if(index == 0){
            nombreUsuarioPedido.innerHTML = `${element.nombre}`;
            element.ordenes.forEach(element =>{
                misOrdenes.innerHTML += 
                `<div class="m-2" id="misPedidos">
                    <div class="row p-10">
                        <h5>${element.nombreProducto}</h5>
                    </div> 
                    <div class="row">
                        <span>${element.descripcion}</span>
                    </div>
                    <div class="row justify-content-end">
                        <span>$${element.precio}</span>
                    </div>       
                    <hr>
                </div>`;
            })
        }
    })

    contenedorU.addEventListener('change', cambiarUsuario);    
}



const cambiarUsuario = () => {
    let nombre = document.getElementById('contenedorUsuarios').value
    let nombreUsuarioPedido = document.getElementById('nombrePedido');
    let nombreUsuario = document.getElementById('nombreUsuario');
    let misOrdenes = document.getElementById('misPedidos');
    misOrdenes.innerHTML = '' ;
    //console.log(nombre);
    usuarios.forEach((element, index)=>{
        if(nombre == index){
            nombreUsuario.innerHTML = `${element.nombre}`;
            nombreUsuarioPedido.innerHTML = `${element.nombre}`
            element.ordenes.forEach(element =>{
                misOrdenes.innerHTML += 
                `<div class="m-2" id="misPedidos">
                    <div class="row p-10">
                        <h5>${element.nombreProducto}</h5>
                        
                    </div> 
                    <div class="row">
                        <span>${element.descripcion}</span>
                    </div>
                    <div class="row justify-content-end">
                        <span>$${element.precio}</span>
                    </div>       
                    <hr>
                </div>`;
            })
            
        }
    })
}
setHome();
//evento ver las empresas 
const verEmpresas = (nombreCategoria1) => {
    let empresas = document.getElementById('empresasC');
    let tituloCategoria = document.getElementById('categoriaSeleccionadaId');
    empresas.innerHTML='';
    
    let categoriaSeleccionada = categorias.filter( (empresa) =>{
        return empresa.nombreCategoria == nombreCategoria1
    })
    //console.log(nombreCategoria1)
    
    let categoriaEmpresas = categoriaSeleccionada[0].empresas;
    tituloCategoria.innerHTML = categoriaSeleccionada[0].nombreCategoria;
    let indiceEmpresa = 0;
    categoriaEmpresas.forEach((element, indexEmpresa) =>{
        indiceEmpresa = indexEmpresa;
        empresas.innerHTML += 
        `<div class="col-12 col-md-6 col-lg-6 mt-2">
            <div class="card">
                <img src="${element.imagen}" class="card-img-top border-alltop" alt="...">
                <div class="card-body" id="productoEmpresa${indexEmpresa}">
                    
                </div>
            </div>
        </div> `;
        
             
        let productoEmpresa = document.getElementById('productoEmpresa'+indexEmpresa);
        element.productos.forEach((element, index)=>{
                //console.log(element);
                productoEmpresa.innerHTML += 
                `<div class="row justify-content-between">
                    <h5 class="card-title">${element.nombreProducto}</h5>
                    <button type="button" class="btn text-white color-lugo rounded-pill border-0 px-4" onclick="addPedido('${nombreCategoria1}',${indiceEmpresa},${index})">Pedir</button>
                </div>
                <div class="row">
                        <span>${element.descripcion}</span>
                </div>
                <div class="row justify-content-end">
                        <span>$${element.precio}</span>
                </div>
                <hr>`
            })
        

    })
    
    $('#modalEmpresas').modal('show');
    
    
}
const addPedido = (nombreCategoria, idEmpresa, idProducto) => {
    
    let nombreProductoAgregar = document.querySelector('#nombreProductoAgregar');
    let descripcionProductoAgregar = document.querySelector('#descripcionProductoAgregar');
    let precioProductoAgregar = document.querySelector('#predcioProductoAgregar');

    let categoriaSeleccionada = categorias.filter(element=>nombreCategoria == element.nombreCategoria);
    categoriaSeleccionada[0].empresas.forEach((element, index) => {
        if(idEmpresa == index){
            element.productos.forEach((element, index) => {
                if(idProducto == index){
                    //console.log(element.nombreProducto)
                    nombreProductoAgregar.innerHTML =  element.nombreProducto;
                    descripcionProductoAgregar.innerHTML = element.descripcion;
                    precioProductoAgregar.innerHTML = element.precio;
                }
            })
        }
    })
    //console.log(categoriaSeleccionada[0], idProducto)
    $('#modalOrdenar').modal('show')
}

const agregarProducto = () => {
    
    let nombreProductoAgregar = document.querySelector('#nombreProductoAgregar').innerHTML;
    let descripcionProductoAgregar = document.querySelector('#descripcionProductoAgregar').innerHTML;
    let precioProductoAgregar = document.querySelector('#predcioProductoAgregar').innerHTML;

    let usuarioSeleccionado = document.getElementById('contenedorUsuarios').value
    let cantidadProducto = document.getElementById('cantidadProducto').value
    
    let data = {
        cantidad: cantidadProducto,
        descripcion: descripcionProductoAgregar,
        nombreProducto: nombreProductoAgregar,
        precio: precioProductoAgregar
    }
    if(nombreProductoAgregar != ' ' && descripcionProductoAgregar != ' ' && cantidadProducto != '' ){
        usuarios.forEach((element, index) => {
            if(usuarioSeleccionado == index){
                element.ordenes.push(data);
                console.log(data);
                localStorage.setItem('usuarios', JSON.stringify(usuarios));
                $('#modalOrdenar').modal('hide');
                
                setHome();
                //$('.toast').toast(false);
                $('.toast').toast('show')
                
            }
        })
    }
    
    
}
//setHome();


//localStorage.clear()

//console.log(storageEmpty());